{"version":3,"sources":["../samples/browser/virtualdom/virtualdom.fsx"],"names":[],"mappings":"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","file":"virtualdom.js","sourcesContent":["(**\n - title: The Elm architecture using Fable\n - tagline: Fable implementation of the Elm architecture\n - app-style: width:800px; margin:20px auto 50px auto;\n - require-paths: `'virtual-dom':'/samples/virtualdom/lib/virtual-dom'`\n - intro: This demo is an implementation of the [Elm architecture](http://guide.elm-lang.org/architecture/)\n   using the same [virtual-dom](https://github.com/Matt-Esch/virtual-dom) as Elm originally used.\n   Contributed by [Tomas Jansson](https://twitter.com/TomasJansson).\n*)\n(*** hide ***)\n#r \"node_modules/fable-core/Fable.Core.dll\"\n#load \"node_modules/fable-import-virtualdom/Fable.Helpers.Virtualdom.fs\"\n(**\n##Architecture overview\n\nThe beauty of the architecture Elm is using for their application is its\nsimplicity. You can read and grasp the whole architecture in a matter of minutes\nhere: http://guide.elm-lang.org/architecture/. I won't explain the architecture\nfurther, instead I will go straight to the examples.\n\n###First example - a simple counter\n\nThe counter below is something you can increment and decrement by clicking on\nthe text. It will also modify the size of the elements with the counter as well\nas the background color of the actual counter.\n\n<div id=\"counter\">\n</div>\n\n*)\nopen Fable.Core\nopen Fable.Import\nopen Fable.Import.Browser\n\nopen Fable.Helpers.Virtualdom\nopen Fable.Helpers.Virtualdom.App\nopen Fable.Helpers.Virtualdom.Html\n\n// model\ntype Counter = int\nlet initCounter = 0\n\n(**\nThe model for the first example is a simple integer that will act as hour counter.\nWe also provide a default value for our counter.\n*)\n\n// Update\ntype CounterAction =\n    | Decrement of int\n    | Increment of int\n\nlet counterUpdate model action =\n    match action with\n    | Decrement x -> model - x\n    | Increment x -> model + x\n    |> (fun m -> m,[])\n\n(**\nThe counter can be incremented or decremented in step of `x`. If you look closely\nthe update function return the new model and a list of something. The list of\nsomething is list of calls js-calls of type `unit->unit` that should be executed\nafter this version of the model has been rendered. We will see in a later example\nwhy this is useful.\n*)\n\n// View\nlet counterView model =\n    let bgColor =\n        match model with\n        | x when x > 100 -> \"red\"\n        | x when x < 0 -> \"blue\"\n        | _ -> \"green\"\n    div []\n        [\n            div [ Style [\"width\", \"120px\"; \"height\", \"120px\"] ] [\n                svg [ width \"120\"; height \"120\"; viewBox \"0 0 100 100\" ]\n                    [ rect [width \"110\"; height \"110\"; fill bgColor] []]\n            ]\n            div [ Style [\"border\",\"1px solid blue\"]\n                  onMouseClick (fun x -> (Increment 1))\n                  onDblClick (fun x -> ((Increment 100)))]\n                [ text (string \"Increment\")]\n            div [ Style [\"background-color\", bgColor; \"color\", \"white\"]]\n                [text (string model)]\n            div [ Style [\"border\", \"1px solid green\";\n                         \"height\", ((string (70 + model)) + \"px\")]\n                  onMouseClick (fun x -> (Decrement 1))\n                  onDblClick (fun x -> (Decrement 50))]\n                [ text (string \"Decrement\")]\n            //    <circle cx=\"50\" cy=\"50\" r=\"40\" stroke=\"black\"\n            //            stroke-width=\"3\" fill=\"red\" />\n        ]\n\n(**\nThe `counterView` defines how a model should be rendered. The dsl that is used\nhere is quite simple and have helper functions for a majority of the standard\nHTML elements. It is trivial to add custom tags if you are missing some tag\nthat you would like to use.\n*)\n\n// Start the application\nlet counterApp =\n    createApp {Model = initCounter; View = counterView; Update = counterUpdate}\n    |> withStartNode \"#counter\"\n\ncounterApp |> start renderer\n\n(**\nThe dsl has been separated from the actual rendering of the dsl, to allow for\nfuture server side rendering as well. So to get this application started you first\nneed to create the application with the `createApp` function. The we pass that\nresult to a helper function to specify where in the document it should be rendered,\ndefault is directly in the body. When we have defined an application we can call\nthe `start` function and pass in a `renderer`. We are using the standard `renderer`\nfor `virtual-dom.js`, but this separation makes it a little bit easier to change\nto another framework in the future.\n\nThat's it, the first application is done and we are ready for example 2.\n\n### Second example - todomvc\n\nTo have something to compare to other js-framework, Elm and whatnot a todomvc app\nis in its place. If you don't know what todomvc is check it out here:\nhttp://todomvc.com/. The app below should have all the features expected from a\ntodomvc app.\n\n<div id=\"todo\">\n</div>\n\nWe will follow the exact same steps as with the counter example. First implement\nthe model, then the update function that to handle actions and lastly the view.\nThis example is a little bit longer and have some more features. I'll also show\nhow easy it is to store data from the model in the local storage, and that could\neasily be swapped to server side storage without effecting any of the application\ncode. Let's start.\n*)\n\n// Todo model\ntype Filter =\n    | All\n    | Completed\n    | Active\n\ntype Item =\n    {\n        Name: string\n        Done: bool\n        Id: int\n        IsEditing: bool\n    }\n\ntype TodoModel =\n    {\n        Items: Item list\n        Input: string\n        Filter: Filter\n    }\n\n(**\nThe model is really simple. It consists of a list of items, which you can edit\nand they can be marked as done. You also have a input field and something to\nfilter the models with. I use a discriminated union to filter the items, which\nis a nice feature you don't have in standard js.\n*)\n\n// Todo update\ntype TodoAction =\n    | AddItem\n    | ChangeInput of string\n    | MarkAsDone of Item\n    | ToggleItem of Item\n    | Destroy of Item\n    | CheckAll\n    | UnCheckAll\n    | SetActiveFilter of Filter\n    | ClearCompleted\n    | EditItem of Item\n    | SaveItem of Item*string\n\n(**\nFirst we define the actual actions before moving on to the actual update function.\n*)\n\nlet todoUpdate model msg =\n    let checkAllWith v =\n        let items' =\n            model.Items\n            |> List.map (fun i -> { i with Done = v })\n        {model with Items = items'}\n\n    let updateItem i model =\n        let items' =\n            model.Items |> List.map (fun i' ->\n                if i'.Id <> i.Id then i' else i)\n        {model with Items = items'}\n\n    let model' =\n        match msg with\n        | AddItem ->\n            let maxId =\n                if model.Items |> List.isEmpty then 1\n                else\n                    model.Items\n                    |> List.map (fun x -> x.Id)\n                    |> List.max\n            let item' = {\n                Id = maxId + 1\n                Name = model.Input\n                Done = false\n                IsEditing = false}\n            {model with Items = item'::model.Items; Input = \"\"}\n        | ChangeInput v -> {model with Input = v}\n        | MarkAsDone i ->\n            let items' =\n                model.Items |> List.map (fun i' ->\n                    if i' <> i then i'\n                    else {i with Done = true})\n            {model with Items = items'}\n        | CheckAll -> checkAllWith true\n        | UnCheckAll -> checkAllWith false\n        | Destroy i ->\n            let items' =\n                model.Items |> List.filter (fun i' -> i'.Id <> i.Id)\n            {model with Items = items'}\n        | ToggleItem i ->\n            updateItem {i with Done = not i.Done} model\n        | SetActiveFilter f ->\n            { model with Filter = f }\n        | ClearCompleted ->\n            let items' =\n                model.Items |> List.filter (fun i -> not i.Done)\n            { model with Items = items'}\n        | EditItem i ->\n            updateItem { i with IsEditing = true} model\n        | SaveItem (i,str) ->\n            updateItem { i with Name = str; IsEditing = false} model\n\n    let jsCalls =\n        match msg with\n        | EditItem i -> [fun () ->\n            document.getElementById(\"item-\" + (i.Id.ToString())).focus()]\n        | _ -> []\n    model',jsCalls\n\n(**\nIt might seem like a lot of code, but we need to handle all actions and respond\nto them accordingly, and this is basically all the logic associated with the todo app. \nI won't go into the detail in all the scenarios, but you\nshould pay attention to the step where `jsCalls` is defined. Since we are re-rendering\nthe application on changes in the model, or render what has changed as least, we need\na way to give an input focus if we start edit it. That is when the list of js\nfunction calls come in handy. So the update function returns the new model a\nlong side a list of js function calls if we need to do something after rendering,\nand that is something we need to do when we start edit an item, we want to give\nthat item focus.\n\nWith this done all we need is to define the view.\n*)\n\n// Todo view\nlet filterToTextAndUrl = function\n    | All -> \"All\", \"\"\n    | Completed -> \"Completed\", \"completed\"\n    | Active -> \"Active\", \"active\"\n\nlet filter activeFilter f =\n    let linkClass = if f = activeFilter then \"selected\" else \"\"\n    let fText,url = f |> filterToTextAndUrl\n    li\n        [ onMouseClick (fun _ -> SetActiveFilter f)]\n        [ a\n            [ attribute \"href\" (\"#/\" + url); attribute \"class\" linkClass ]\n            [ text fText] ]\n\nlet filters model =\n    ul\n        [ attribute \"class\" \"filters\" ]\n        ([ All; Active; Completed ] |> List.map (filter model.Filter))\n\nlet todoFooter model =\n    let clearVisibility =\n        if model.Items |> List.exists (fun i -> i.Done)\n        then \"\"\n        else \"none\"\n    let activeCount =\n        model.Items\n        |> List.filter (fun i -> not i.Done)\n        |> List.length |> string\n    footer\n        [   attribute \"class\" \"footer\"; Style [\"display\",\"block\"]]\n        [   span\n                [   attribute \"class\" \"todo-count\" ]\n                [   strong [] [text activeCount]\n                    text \" items left\" ]\n            (filters model)\n            button\n                [   attribute \"class\" \"clear-completed\"\n                    Style [ \"display\", clearVisibility ]\n                    onMouseClick (fun _ -> ClearCompleted)]\n                [ text \"Clear completed\" ] ]\n\nlet todoHeader model =\n    header\n        [attribute \"class\" \"header\"]\n        [   h1 [] [text \"todos\"]\n            input [ attribute \"class\" \"new-todo\"\n                    attribute \"id\" \"new-todo\"\n                    property \"value\" model\n                    property \"placeholder\" \"What needs to be done?\"\n                    onKeyup (fun x ->\n                        if x.keyCode = 13\n                        then AddItem\n                        else ChangeInput (x?target?value :?> string)) ]]\nlet listItem item =\n    let itemChecked = if item.Done then \"true\" else \"\"\n    let editClass = if item.IsEditing then \"editing\" else \"\"\n    li [ attribute \"class\" ((if item.Done then \"completed \" else \" \") + editClass)]\n       [ div [  attribute \"class\" \"view\"\n                onDblClick (fun x -> EditItem item) ]\n             [ input [  property \"className\" \"toggle\"\n                        property \"type\" \"checkbox\"\n                        property \"checked\" itemChecked\n                        onMouseClick (fun e -> ToggleItem item) ]\n               label [] [ text item.Name ]\n               button [ attribute \"class\" \"destroy\"\n                        onMouseClick (fun e -> Destroy item) ] [] ]\n         input [ attribute \"class\" \"edit\"\n                 attribute \"value\" item.Name\n                 property \"id\" (\"item-\"+item.Id.ToString())\n                 onBlur (fun e -> SaveItem (item, (e?target?value :?> string))) ] ]\n\nlet itemList items activeFilter =\n    let filterItems i =\n        match activeFilter with\n        | All -> true\n        | Completed -> i.Done\n        | Active -> not i.Done\n\n    ul [attribute \"class\" \"todo-list\" ]\n       (items |> List.filter filterItems |> List.map listItem)\n\nlet todoMain model =\n    let items = model.Items\n    let allChecked = items |> List.exists (fun i -> not i.Done)\n    section [  attribute \"class\" \"main\"\n               Style [ \"style\", \"block\" ] ]\n            [   input [ property \"id\" \"toggle-all\"\n                        attribute \"class\" \"toggle-all\"\n                        property \"type\" \"checkbox\"\n                        property \"checked\" (if not allChecked then \"true\" else \"\")\n                        onMouseClick (fun e ->\n                                    if allChecked\n                                    then CheckAll\n                                    else UnCheckAll) ]\n                label [ attribute \"for\" \"toggle-all\" ]\n                      [ text \"Mark all as complete\" ]\n                (itemList items model.Filter) ]\n\nlet todoView model =\n    section\n        [property \"class\" \"todoapp\"]\n        ((todoHeader model.Input)::(if model.Items |> List.isEmpty\n                then []\n                else [  (todoMain model)\n                        (todoFooter model) ] ))\n\n(**\nThis view is more complex than the first example, but it also show how easy it is\nto split a view up into pieces and then combine them together to form a whole. This\nmakes it quite easy to re-use parts in different views.\n\nOne thing to notice is that only a few properties are mapped at the moment, but if\nyou know the property name you can use the syntax `e?target?value`, which will\nlook app the `value` property on the `target` property on the `e` event as in the\nexample above.\n\nBefore this is done, there are one hidden gem that is worth knowing, and it will\nbe showed with two examples. We will add local storage support of the items and a\nlogger of all the actions and model changes. First we need a helper for the storage.\n*)\n\n// Storage\nmodule Storage =\n    let private STORAGE_KEY = \"vdom-storage\"\n    open Microsoft.FSharp.Core\n    let fetch<'T> (): 'T [] =\n        Browser.localStorage.getItem(STORAGE_KEY)\n        |> function null -> \"[]\" | x -> unbox x\n        |> JS.JSON.parse |> unbox\n\n    let save<'T> (todos: 'T []) =\n        Browser.localStorage.setItem(STORAGE_KEY, JS.JSON.stringify todos)\n\n(**\nThe module above is a simple helper to store a list of items in local storage\nof the browser, now let's add it and support for logging.\n*)\n\nopen Storage\nlet initList = fetch<Item>() |> List.ofArray\nlet initModel = {Filter = All; Items = initList; Input = \"\"}\n\nlet todoApp =\n    createApp {Model = initModel; View = todoView; Update = todoUpdate}\n    |> (withSubscriber \"storagesub\" (function\n            | ModelChanged (newModel,old) ->\n                save (newModel.Items |> Array.ofList)\n            | _ -> ()))\n    |> (withSubscriber \"modellogger\" (printfn \"%A\"))\n    |> withStartNode \"#todo\"\n\ntodoApp |> start renderer\n\n(**\nFirst we initiate the model by checking the local storage if there are any items\nthere. The to add support for local storage we add a subscriber. A subscriber is\na function that handles `AppEvents`, they can be `ModelChanged` or `ActionReceived`.\nFor the storage we are only interested in model changes, so that is what we act on\nand store the list of items in the local storage when the model was changed. For\nthe logger we just logs everything.\n\nWe also start the application on the `#todo` element in the document.\n*)"]}